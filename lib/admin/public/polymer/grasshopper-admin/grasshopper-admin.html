<link rel='import' href='/admin/polymer/bower/polymer/polymer.html' />

<link rel="import" href="/admin/polymer/bower/app-route/app-location.html">
<link rel="import" href="/admin/polymer/bower/app-route/app-route.html">
<link rel="import" href="/admin/polymer/bower/iron-pages/iron-pages.html">
<link rel="import" href="/admin/polymer/bower/iron-selector/iron-selector.html">

<link rel='stylesheet' href='/admin/main.css'>

<dom-module id='grasshopper-admin'>
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <app-location route='{{baseRoute}}{{route}}'></app-location>
        <app-route route='{{route}}' pattern='/:page' data='{{routeData}}' tail='{{subroute}}'></app-route>

        <iron-pages selected='[[page]]' attr-for-selected='name' fallback-selection='404' role='main'>
            <grasshopper-admin-settings name='settings'></grasshopper-admin-settings>
            <grasshopper-admin-404 name='404'></grasshopper-admin-404>
        </iron-pages>
    </template>
    <script>
        Polymer({
            is: 'grasshopper-admin',
            properties: {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },
                baseRoute : {
                    type : String,
                    reflectToAttribute : true
                },
                routeMapping : {
                    type : Object,
                    value : {
                        'settings' : {
                            url : '/admin/settings'
                        },
                        '404' : {
                            url : '/admin/polymer/404/404.html'
                        }
                    }
                }
            },
            observers: [
                '_routeChanged(routeData.page)'
            ],
            _routeChanged: function(page) {
                this.page = page || 'settings';
            },
            _pageChanged: function(page) {
                this.importHref(this.routeMapping[this.page].url, function() {
                    this.set('route.path', this.page);
                }.bind(this), this._showPage404, true);
            },
            _showPage404: function() {
                this.page = '404';
            }
        });
    </script>
</dom-module>